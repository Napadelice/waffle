<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Appendix&nbsp;B.&nbsp;The Security Namespace</title><link rel="stylesheet" href="css/manual.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="springsecurity.html" title="Spring Security"><link rel="up" href="springsecurity.html" title="Spring Security"><link rel="prev" href="appendix-schema.html" title="Appendix&nbsp;A.&nbsp;Security Database Schema"><!--Begin Google Analytics code--><script type="text/javascript">
			var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
			document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		</script><script type="text/javascript">
			var pageTracker = _gat._getTracker("UA-2728886-3");
			pageTracker._setDomainName("none");
			pageTracker._setAllowLinker(true);
			pageTracker._trackPageview();
		</script><!--End Google Analytics code--></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix&nbsp;B.&nbsp;The Security Namespace</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="appendix-schema.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;</td></tr></table><hr></div><div class="appendix" title="Appendix&nbsp;B.&nbsp;The Security Namespace"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-namespace"></a>Appendix&nbsp;B.&nbsp;The Security Namespace</h2></div></div></div>
  
  <p> This appendix provides a reference to the elements available in the security namespace and
    information on the underlying beans they create (a knowledge of the individual classes and how
    they work together is assumed - you can find more information in the project Javadoc and
    elsewhere in this document). If you haven't used the namespace before, please read the <a class="ulink" href="#ns-config" target="_top">introductory chapter</a> on namespace configuration, as this is
    intended as a supplement to the information there. Using a good quality XML editor while editing
    a configuration based on the schema is recommended as this will provide contextual information
    on which elements and attributes are available as well as comments explaining their purpose. The
    namespace is written in <a class="ulink" href="http://www.relaxng.org/" target="_top">RELAX NG</a> Compact
    format and later converted into an XSD schema. If you are familiar with this format, you may
    wish to examine the <a class="ulink" href="https://src.springsource.org/svn/spring-security/trunk/config/src/main/resources/org/springframework/security/config/spring-security-3.0.rnc" target="_top">schema file</a> directly.</p>
  <div class="section" title="B.1&nbsp;Web Application Security - the <http&gt; Element"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="nsa-http"></a>B.1&nbsp;Web Application Security - the <code class="literal">&lt;http&gt;</code> Element</h2></div></div></div>
    
    <p> The <code class="literal">&lt;http&gt;</code> element encapsulates the security configuration for
      the web layer of your application. It creates a <code class="classname">FilterChainProxy</code> bean
      named "springSecurityFilterChain" which maintains the stack of security filters which make up
      the web security configuration <sup>[<a name="d4e3084" href="#ftn.d4e3084" class="footnote">15</a>]</sup>. Some core filters are always created and others will be added to the stack
      depending on the attributes child elements which are present. The positions of the standard
      filters are fixed (see <a class="ulink" href="#filter-stack" target="_top">the filter order table</a> in the
      namespace introduction), removing a common source of errors with previous versions of the
      framework when users had to configure the filter chain explicitly in
        the<code class="classname">FilterChainProxy</code> bean. You can, of course, still do this if you
      need full control of the configuration. </p>
    <p> All filters which require a reference to the
        <code class="interfacename">AuthenticationManager</code> will be automatically injected with the
      internal instance created by the namespace configuration (see the <a class="ulink" href="#ns-auth-manager" target="_top"> introductory chapter</a> for more on the
        <code class="interfacename">AuthenticationManager</code>). </p>
    <p> The <code class="literal">&lt;http&gt;</code> namespace block always creates an
        <code class="classname">HttpSessionContextIntegrationFilter</code>, an
        <code class="classname">ExceptionTranslationFilter</code> and a
        <code class="classname">FilterSecurityInterceptor</code>. These are fixed and cannot be replaced
      with alternatives. </p>
    <div class="section" title="B.1.1&nbsp;<http&gt; Attributes"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-http-attributes"></a>B.1.1&nbsp;<code class="literal">&lt;http&gt;</code> Attributes</h3></div></div></div>
      
      <p> The attributes on the <code class="literal">&lt;http&gt;</code> element control some of the
        properties on the core filters. </p>
      <div class="section" title="servlet-api-provision"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-servlet-api-provision"></a><code class="literal">servlet-api-provision</code></h4></div></div></div>
        
        <p> Provides versions of <code class="literal">HttpServletRequest</code> security methods such as
            <code class="literal">isUserInRole()</code> and <code class="literal">getPrincipal()</code> which are
          implemented by adding a <code class="classname">SecurityContextHolderAwareRequestFilter</code>
          bean to the stack. Defaults to "true". </p>
      </div>
      <div class="section" title="path-type"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-path-type"></a><code class="literal">path-type</code></h4></div></div></div>
        
        <p> Controls whether URL patterns are interpreted as ant paths (the default) or regular
          expressions. In practice this sets a particular <code class="interfacename">UrlMatcher</code>
          instance on the <code class="classname">FilterChainProxy</code>. </p>
      </div>
      <div class="section" title="lowercase-comparisons"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-lowercase-comparisons"></a><code class="literal">lowercase-comparisons</code></h4></div></div></div>
        
        <p> Whether test URLs should be converted to lower case prior to comparing with defined
          path patterns. If unspecified, defaults to "true" </p>
      </div>
      <div class="section" title="realm"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-realm"></a><code class="literal">realm</code></h4></div></div></div>
        
        <p> Sets the realm name used for basic authentication (if enabled). Corresponds to the
            <code class="literal">realmName</code> property on
            <code class="classname">BasicAuthenticationEntryPoint</code>. </p>
      </div>
      <div class="section" title="entry-point-ref"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-entry-point-ref"></a><code class="literal">entry-point-ref</code></h4></div></div></div>
        
        <p> Normally the <code class="interfacename">AuthenticationEntryPoint</code> used will be set
          depending on which authentication mechanisms have been configured. This attribute allows
          this behaviour to be overridden by defining a customized
            <code class="interfacename">AuthenticationEntryPoint</code> bean which will start the
          authentication process. </p>
      </div>
      <div class="section" title="access-decision-manager-ref"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-access-decision-manager-ref"></a><code class="literal">access-decision-manager-ref</code></h4></div></div></div>
        
        <p> Optional attribute specifying the ID of the
            <code class="interfacename">AccessDecisionManager</code> implementation which should be used
          for authorizing HTTP requests. By default an <code class="classname">AffirmativeBased</code>
          implementation is used for with a <code class="classname">RoleVoter</code> and an
            <code class="classname">AuthenticatedVoter</code>. </p>
      </div>
      <div class="section" title="access-denied-page"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-access-denied-page"></a><code class="literal">access-denied-page</code></h4></div></div></div>
        
        <p> Deprecated in favour of the <code class="literal">access-denied-handler</code> child element.
        </p>
      </div>
      <div class="section" title="once-per-request"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-once-per-request"></a><code class="literal">once-per-request</code></h4></div></div></div>
        
        <p> Corresponds to the <code class="literal">observeOncePerRequest</code> property of
            <code class="classname">FilterSecurityInterceptor</code>. Defaults to "true". </p>
      </div>
      <div class="section" title="create-session"><div class="titlepage"><div><div><h4 class="title"><a name="create-session"></a><code class="literal">create-session</code></h4></div></div></div>
        
        <p> Controls the eagerness with which an HTTP session is created. If not set, defaults to
          "ifRequired". Other options are "always" and "never". The setting of this attribute affect
          the <code class="literal">allowSessionCreation</code> and
            <code class="literal">forceEagerSessionCreation</code> properties of
            <code class="classname">HttpSessionContextIntegrationFilter</code>.
            <code class="literal">allowSessionCreation</code> will always be true unless this attribute is set
          to "never". <code class="literal">forceEagerSessionCreation</code> is "false" unless it is set to
          "always". So the default configuration allows session creation but does not force it. The
          exception is if concurrent session control is enabled, when
            <code class="literal">forceEagerSessionCreation</code> will be set to true, regardless of what the
          setting is here. Using "never" would then cause an exception during the initialization of
            <code class="classname">HttpSessionContextIntegrationFilter</code>. </p>
      </div>
    </div>
    <div class="section" title="B.1.2&nbsp;<access-denied-handler&gt;"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-access-denied-handler"></a>B.1.2&nbsp;<code class="literal">&lt;access-denied-handler&gt;</code></h3></div></div></div>
      
      <p> This element allows you to set the <code class="literal">errorPage</code> property for the
        default <code class="interfacename">AccessDeniedHandler</code> used by the
          <code class="classname">ExceptionTranslationFilter</code>, (using the
          <code class="literal">error-page</code> attribute, or to supply your own implementation using the
          <code class="literal">ref</code> attribute. This is discussed in more detail in the section on <a class="ulink" href="#access-denied-handler" target="_top">the
          <code class="classname">ExceptionTranslationFilter</code></a>.</p>
    </div>
    <div class="section" title="B.1.3&nbsp;The <intercept-url&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="d4e3175"></a>B.1.3&nbsp;The <code class="literal">&lt;intercept-url&gt;</code> Element</h3></div></div></div>
      
      <p> This element is used to define the set of URL patterns that the application is
        interested in and to configure how they should be handled. It is used to construct the
          <code class="interfacename">FilterInvocationSecurityMetadataSource</code> used by the
          <code class="classname">FilterSecurityInterceptor</code> and to exclude particular patterns from
        the filter chain entirely (by setting the attribute <code class="literal">filters="none"</code>). It
        is also responsible for configuring a <code class="classname">ChannelAuthenticationFilter</code> if
        particular URLs need to be accessed by HTTPS, for example. When matching the specified
        patterns against an incoming request, the matching is done in the order in which the
        elements are declared. So the most specific matches patterns should come first and the most
        general should come last.</p>
      <div class="section" title="pattern"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-pattern"></a><code class="literal">pattern</code></h4></div></div></div>
        
        <p> The pattern which defines the URL path. The content will depend on the
            <code class="literal">path-type</code> attribute from the containing http element, so will default
          to ant path syntax. </p>
      </div>
      <div class="section" title="method"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-method"></a><code class="literal">method</code></h4></div></div></div>
        
        <p> The HTTP Method which will be used in combination with the pattern to match an
          incoming request. If omitted, any method will match. If an identical pattern is specified
          with and without a method, the method-specific match will take precedence.</p>
      </div>
      <div class="section" title="access"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-access"></a><code class="literal">access</code></h4></div></div></div>
        
        <p> Lists the access attributes which will be stored in the
            <code class="interfacename">FilterInvocationSecurityMetadataSource</code> for the defined URL
          pattern/method combination. This should be a comma-separated list of the security
          configuration attributes (such as role names). </p>
      </div>
      <div class="section" title="requires-channel"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-requires-channel"></a><code class="literal">requires-channel</code></h4></div></div></div>
        
        <p> Can be <span class="quote">&#8220;<span class="quote">http</span>&#8221;</span> or <span class="quote">&#8220;<span class="quote">https</span>&#8221;</span> depending on whether a particular
          URL pattern should be accessed over HTTP or HTTPS respectively. Alternatively the value
            <span class="quote">&#8220;<span class="quote">any</span>&#8221;</span> can be used when there is no preference. If this attribute is present
          on any <code class="literal">&lt;intercept-url&gt;</code> element, then a
            <code class="classname">ChannelAuthenticationFilter</code> will be added to the filter stack and
          its additional dependencies added to the application
          context.</p>
        <p> If a <code class="literal">&lt;port-mappings&gt;</code> configuration is added, this will be
          used to by the <code class="classname">SecureChannelProcessor</code> and
            <code class="classname">InsecureChannelProcessor</code> beans to determine the ports used for
          redirecting to HTTP/HTTPS. </p>
      </div>
      <div class="section" title="filters"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3210"></a><code class="literal">filters</code></h4></div></div></div>
        
        <p>Can only take the value <span class="quote">&#8220;<span class="quote">none</span>&#8221;</span>. This will cause any matching request to
          bypass the Spring Security filter chain entirely. None of the rest of the
            <code class="literal">&lt;http&gt;</code> configuration will have any effect on the request and there
          will be no security context available for its duration. Access to secured methods during
          the request will fail.</p>
      </div>
    </div>
    <div class="section" title="B.1.4&nbsp;The <port-mappings&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="d4e3216"></a>B.1.4&nbsp;The <code class="literal">&lt;port-mappings&gt;</code> Element</h3></div></div></div>
      
      <p> By default, an instance of <code class="classname">PortMapperImpl</code> will be added to the
        configuration for use in redirecting to secure and insecure URLs. This element can
        optionally be used to override the default mappings which that class defines. Each child
          <code class="literal">&lt;port-mapping&gt;</code> element defines a pair of HTTP:HTTPS ports. The
        default mappings are 80:443 and 8080:8443. An example of overriding these can be found in
        the <a class="ulink" href="#ns-requires-channel" target="_top">namespace introduction</a>. </p>
    </div>
    <div class="section" title="B.1.5&nbsp;The <form-login&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-form-login"></a>B.1.5&nbsp;The <code class="literal">&lt;form-login&gt;</code> Element</h3></div></div></div>
      
      <p> Used to add an <code class="classname">UsernamePasswordAuthenticationFilter</code> to the
        filter stack and an <code class="classname">LoginUrlAuthenticationEntryPoint</code> to the
        application context to provide authentication on demand. This will always take precedence
        over other namespace-created entry points. If no attributes are supplied, a login page will
        be generated automatically at the URL "/spring-security-login" <sup>[<a name="d4e3229" href="#ftn.d4e3229" class="footnote">16</a>]</sup> The behaviour can be customized using the following attributes. </p>
      <div class="section" title="login-page"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3232"></a><code class="literal">login-page</code></h4></div></div></div>
        
        <p> The URL that should be used to render the login page. Maps to the
            <code class="literal">loginFormUrl</code> property of the
            <code class="classname">LoginUrlAuthenticationEntryPoint</code>. Defaults to
          "/spring-security-login". </p>
      </div>
      <div class="section" title="login-processing-url"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3238"></a><code class="literal">login-processing-url</code></h4></div></div></div>
        
        <p> Maps to the <code class="literal">filterProcessesUrl</code> property of
            <code class="classname">UsernamePasswordAuthenticationFilter</code>. The default value is
          "/j_spring_security_check". </p>
      </div>
      <div class="section" title="default-target-url"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3244"></a><code class="literal">default-target-url</code></h4></div></div></div>
        
        <p>Maps to the <code class="literal">defaultTargetUrl</code> property of
            <code class="classname">UsernamePasswordAuthenticationFilter</code>. If not set, the default
          value is "/" (the application root). A user will be taken to this URL after logging in,
          provided they were not asked to login while attempting to access a secured resource, when
          they will be taken to the originally requested URL. </p>
      </div>
      <div class="section" title="always-use-default-target"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3250"></a><code class="literal">always-use-default-target</code></h4></div></div></div>
        
        <p> If set to "true", the user will always start at the value given by
            <code class="literal">default-target-url</code>, regardless of how they arrived at the login page.
          Maps to the <code class="literal">alwaysUseDefaultTargetUrl</code> property of
            <code class="classname">UsernamePasswordAuthenticationFilter</code>. Default value is "false".
        </p>
      </div>
      <div class="section" title="authentication-failure-url"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3257"></a><code class="literal">authentication-failure-url</code></h4></div></div></div>
        
        <p> Maps to the <code class="literal">authenticationFailureUrl</code> property of
            <code class="classname">UsernamePasswordAuthenticationFilter</code>. Defines the URL the browser
          will be redirected to on login failure. Defaults to "/spring_security_login?login_error",
          which will be automatically handled by the automatic login page generator, re-rendering
          the login page with an error message. </p>
      </div>
      <div class="section" title="authentication-success-handler-ref"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3263"></a><code class="literal">authentication-success-handler-ref</code></h4></div></div></div>
        
        <p>This can be used as an alternative to <code class="literal">default-target-url</code> and
            <code class="literal">always-use-default-target</code>, giving you full control over the
          navigation flow after a successful authentication. The value should be he name of an
            <code class="interfacename">AuthenticationSuccessHandler</code> bean in the application
          context. </p>
      </div>
      <div class="section" title="authentication-failure-handler-ref"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3270"></a><code class="literal">authentication-failure-handler-ref</code></h4></div></div></div>
        
        <p>Can be used as an alternative to <code class="literal">authentication-failure-url</code>, giving
          you full control over the navigation flow after an authentication failure. The value
          should be he name of an <code class="interfacename">AuthenticationFailureHandler</code> bean
          in the application context. </p>
      </div>
    </div>
    <div class="section" title="B.1.6&nbsp;The <http-basic&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-http-basic"></a>B.1.6&nbsp;The <code class="literal">&lt;http-basic&gt;</code> Element</h3></div></div></div>
      
      <p> Adds a <code class="classname">BasicAuthenticationFilter</code> and
          <code class="classname">BasicAuthenticationEntryPoint</code> to the configuration. The latter will
        only be used as the configuration entry point if form-based login is not enabled. </p>
    </div>
    <div class="section" title="B.1.7&nbsp;The <remember-me&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-remember-me"></a>B.1.7&nbsp;The <code class="literal">&lt;remember-me&gt;</code> Element</h3></div></div></div>
      
      <p> Adds the <code class="classname">RememberMeAuthenticationFilter</code> to the stack. This in
        turn will be configured with either a <code class="classname">TokenBasedRememberMeServices</code>, a
          <code class="classname">PersistentTokenBasedRememberMeServices</code> or a user-specified bean
        implementing <code class="interfacename">RememberMeServices</code> depending on the attribute
        settings. </p>
      <div class="section" title="data-source-ref"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3290"></a><code class="literal">data-source-ref</code></h4></div></div></div>
        
        <p> If this is set, <code class="classname">PersistentTokenBasedRememberMeServices</code> will be
          used and configured with a <code class="classname">JdbcTokenRepositoryImpl</code> instance.
        </p>
      </div>
      <div class="section" title="token-repository-ref"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3296"></a><code class="literal">token-repository-ref</code></h4></div></div></div>
        
        <p> Configures a <code class="classname">PersistentTokenBasedRememberMeServices</code> but allows
          the use of a custom <code class="interfacename">PersistentTokenRepository</code> bean. </p>
      </div>
      <div class="section" title="services-ref"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3302"></a><code class="literal">services-ref</code></h4></div></div></div>
        
        <p> Allows complete control of the <code class="interfacename">RememberMeServices</code>
          implementation that will be used by the filter. The value should be the Id of a bean in
          the application context which implements this interface. </p>
      </div>
      <div class="section" title="token-repository-ref"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3307"></a><code class="literal">token-repository-ref</code></h4></div></div></div>
        
        <p> Configures a <code class="classname">PersistentTokenBasedRememberMeServices</code> but allows
          the use of a custom <code class="interfacename">PersistentTokenRepository</code> bean. </p>
      </div>
      <div class="section" title="The key Attribute"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3313"></a>The <code class="literal">key</code> Attribute</h4></div></div></div>
        
        <p>Maps to the "key" property of <code class="classname">AbstractRememberMeServices</code>.
          Should be set to a unique value to ensure that remember-me cookies are only valid within
          the one application <sup>[<a name="d4e3318" href="#ftn.d4e3318" class="footnote">17</a>]</sup>. </p>
      </div>
      <div class="section" title="token-validity-seconds"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3321"></a><code class="literal">token-validity-seconds</code></h4></div></div></div>
        
        <p> Maps to the <code class="literal">tokenValiditySeconds</code> property of
            <code class="classname">AbstractRememberMeServices</code>. Specifies the period in seconds for
          which the remember-me cookie should be valid. By default it will be valid for 14 days.
        </p>
      </div>
      <div class="section" title="user-service-ref"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3327"></a><code class="literal">user-service-ref</code></h4></div></div></div>
        
        <p> The remember-me services implementations require access to a
            <code class="interfacename">UserDetailsService</code>, so there has to be one defined in the
          application context. If there is only one, it will be selected and used automatically by
          the namespace configuration. If there are multiple instances, you can specify a bean Id
          explicitly using this attribute. </p>
      </div>
    </div>
    <div class="section" title="B.1.8&nbsp;The <session-management&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-session-mgmt"></a>B.1.8&nbsp;The <code class="literal">&lt;session-management&gt;</code> Element</h3></div></div></div>
      
      <p>Session-management related functionality is implemented by the addition of a
          <code class="classname">SessionManagementFilter</code> to the filter stack.</p>
      <div class="section" title="session-fixation-protection"><div class="titlepage"><div><div><h4 class="title"><a name="session-fixation-protection"></a><code class="literal">session-fixation-protection</code></h4></div></div></div>
        
        <p> Indicates whether an existing session should be invalidated when a user authenticates
          and a new session started. If set to "none" no change will be made. "newSession" will
          create a new empty session. "migrateSession" will create a new session and copy the
          session attributes to the new session. Defaults to "migrateSession".</p>
        <p> If session fixation protection is enabled, the
            <code class="classname">SessionManagementFilter</code> is inected with a appropriately
          configured <code class="classname">DefaultSessionAuthenticationStrategy</code>. See the Javadoc
          for this class for more details. </p>
      </div>
    </div>
    <div class="section" title="B.1.9&nbsp;The <concurrency-control&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-concurrent-session-control"></a>B.1.9&nbsp;The <code class="literal">&lt;concurrency-control&gt;</code> Element</h3></div></div></div>
      
      <p> Adds support for concurrent session control, allowing limits to be placed on the number
        of active sessions a user can have. A <code class="classname">ConcurrentSessionFilter</code> will be
        created, and a <code class="classname">ConcurrentSessionControlStrategy</code> will be used with the
          <code class="classname">SessionManagementFilter</code>. If a <code class="literal">form-login</code> element
        has been declared, the strategy object will also be injected into the created authentication
        filter. An instance of <code class="interfacename">SessionRegistry</code> (a
          <code class="classname">SessionRegistryImpl</code> instance unless the user wishes to use a custom
        bean) will be created for use by the strategy.</p>
      <div class="section" title="The max-sessions attribute"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3354"></a>The <code class="literal">max-sessions</code> attribute</h4></div></div></div>
        
        <p>Maps to the <code class="literal">maximumSessions</code> property of
            <code class="classname">ConcurrentSessionControlStrategy</code>.</p>
      </div>
      <div class="section" title="The expired-url attribute"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3360"></a>The <code class="literal">expired-url</code> attribute</h4></div></div></div>
        
        <p> The URL a user will be redirected to if they attempt to use a session which has been
          "expired" by the concurrent session controller because the user has exceeded the number of
          allowed sessions and has logged in again elsewhere. Should be set unless
            <code class="literal">exception-if-maximum-exceeded</code> is set. If no value is supplied, an
          expiry message will just be written directly back to the response. </p>
      </div>
      <div class="section" title="The error-if-maximum-exceeded attribute"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3365"></a>The <code class="literal">error-if-maximum-exceeded</code> attribute</h4></div></div></div>
        
        <p>If set to "true" a <code class="exceptionname">SessionAuthenticationException</code> will
          be raised when a user attempts to exceed the maximum allowed number of sessions. The
          default behaviour is to expire the original session. </p>
      </div>
      <div class="section" title="The session-registry-alias and session-registry-ref attributes"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3370"></a>The <code class="literal">session-registry-alias</code> and
            <code class="literal">session-registry-ref</code> attributes</h4></div></div></div>
        
        <p> The user can supply their own <code class="interfacename">SessionRegistry</code>
          implementation using the <code class="literal">session-registry-ref</code> attribute. The other
          concurrent session control beans will be wired up to use it. </p>
        <p> It can also be useful to have a reference to the internal session registry for use in
          your own beans or an admin interface. You can expose the interal bean using the
            <code class="literal">session-registry-alias</code> attribute, giving it a name that you can use
          elsewhere in your configuration. </p>
      </div>
    </div>
    <div class="section" title="B.1.10&nbsp;The <anonymous&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-anonymous"></a>B.1.10&nbsp;The <code class="literal">&lt;anonymous&gt;</code> Element</h3></div></div></div>
      
      <p> Adds an <code class="classname">AnonymousAuthenticationFilter</code> to the stack and an
          <code class="classname">AnonymousAuthenticationProvider</code>. Required if you are using the
          <code class="literal">IS_AUTHENTICATED_ANONYMOUSLY</code> attribute. </p>
    </div>
    <div class="section" title="B.1.11&nbsp;The <x509&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-x509"></a>B.1.11&nbsp;The <code class="literal">&lt;x509&gt;</code> Element</h3></div></div></div>
      
      <p> Adds support for X.509 authentication. An
          <code class="classname">X509AuthenticationFilter</code> will be added to the stack and an
          <code class="classname">Http403ForbiddenEntryPoint</code> bean will be created. The latter will
        only be used if no other authentication mechanisms are in use (it's only functionality is to
        return an HTTP 403 error code). A
          <code class="classname">PreAuthenticatedAuthenticationProvider</code> will also be created which
        delegates the loading of user authorities to a
          <code class="interfacename">UserDetailsService</code>. </p>
      <div class="section" title="The subject-principal-regex attribute"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3394"></a>The <code class="literal">subject-principal-regex</code> attribute</h4></div></div></div>
        
        <p> Defines a regular expression which will be used to extract the username from the
          certificate (for use with the <code class="interfacename">UserDetailsService</code>). </p>
      </div>
      <div class="section" title="The user-service-ref attribute"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3399"></a>The <code class="literal">user-service-ref</code> attribute</h4></div></div></div>
        
        <p> Allows a specific <code class="interfacename">UserDetailsService</code> to be used with
          X.509 in the case where multiple instances are configured. If not set, an attempt will be
          made to locate a suitable instance automatically and use that. </p>
      </div>
    </div>
    <div class="section" title="B.1.12&nbsp;The <openid-login&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-openid-login"></a>B.1.12&nbsp;The <code class="literal">&lt;openid-login&gt;</code> Element</h3></div></div></div>
      
      <p> Similar to <code class="literal">&lt;form-login&gt;</code> and has the same attributes. The
        default value for <code class="literal">login-processing-url</code> is
        "/j_spring_openid_security_check". An <code class="classname">OpenIDAuthenticationFilter</code> and
          <code class="classname">OpenIDAuthenticationProvider</code> will be registered. The latter
        requires a reference to a <code class="interfacename">UserDetailsService</code>. Again, this can
        be specified by Id, using the <code class="literal">user-service-ref</code> attribute, or will be
        located automatically in the application context. </p>
    </div>
    <div class="section" title="B.1.13&nbsp;The <logout&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="nsa-logout"></a>B.1.13&nbsp;The <code class="literal">&lt;logout&gt;</code> Element</h3></div></div></div>
      
      <p> Adds a <code class="classname">LogoutFilter</code> to the filter stack. This is configured with
        a <code class="classname">SecurityContextLogoutHandler</code>. </p>
      <div class="section" title="The logout-url attribute"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3420"></a>The <code class="literal">logout-url</code> attribute</h4></div></div></div>
        
        <p> The URL which will cause a logout (i.e. which will be processed by the filter).
          Defaults to "/j_spring_security_logout". </p>
      </div>
      <div class="section" title="The logout-success-url attribute"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3424"></a>The <code class="literal">logout-success-url</code> attribute</h4></div></div></div>
        
        <p> The destination URL which the user will be taken to after logging out. Defaults to
          "/". </p>
      </div>
      <div class="section" title="The invalidate-session attribute"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3428"></a>The <code class="literal">invalidate-session</code> attribute</h4></div></div></div>
        
        <p> Maps to the <code class="literal">invalidateHttpSession</code> of the
            <code class="classname">SecurityContextLogoutHandler</code>. Defaults to "true", so the session
          will be invalidated on logout. </p>
      </div>
    </div>
    <div class="section" title="B.1.14&nbsp;The <custom-filter&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="d4e3434"></a>B.1.14&nbsp;The <code class="literal">&lt;custom-filter&gt;</code> Element</h3></div></div></div>
      
      <p>This element is used to add a filter to the filter chain. It doesn't create any
        additional beans but is used to select a bean of type
          <code class="interfacename">javax.servlet.Filter</code> which is already defined in the
        appllication context and add that at a particular position in the filter chain maintained by
        Spring Security. Full details can be found in the namespace chapter.</p>
    </div>
  </div>
  <div class="section" title="B.2&nbsp;Authentication Services"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e3439"></a>B.2&nbsp;Authentication Services</h2></div></div></div>
    
    <p> Before Spring Security 3.0, an <code class="interfacename">AuthenticationManager</code> was
      automatically registered internally. Now you must register one explicitly using the
        <code class="literal">&lt;authentication-manager&gt;</code> element. This creates an instance of
      Spring Security's <code class="classname">ProviderManager</code> class, which needs to be configured
      with a list of one or more <code class="interfacename">AuthenticationProvider</code> instances.
      These can either be created using syntax elements provided by the namespace, or they can be
      standard bean definitions, marked for addition to the list using the
        <code class="literal">authentication-provider</code> element. </p>
    <div class="section" title="B.2.1&nbsp;The <authentication-manager&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="d4e3447"></a>B.2.1&nbsp;The <code class="literal">&lt;authentication-manager&gt;</code> Element</h3></div></div></div>
      
      <p> Every Spring Security application which uses the namespace must have include this
        element somewhere. It is responsible for registering the
          <code class="interfacename">AuthenticationManager</code> which provides authentication
        services to the application. It also allows you to define an alias name for the internal
        instance for use in your own configuration. Its use is described in the 
          <a class="ulink" href="#ns-auth-manager" target="_top">namespace introduction</a>. All elements which create
          <code class="interfacename">AuthenticationProvider</code> instances should be children of this
          element.</p>
      <p>
          The element also exposes an <code class="literal">erase-credentials</code> attribute which maps
          to the <code class="literal">eraseCredentialsAfterAuthentication</code> property of
          the <code class="classname">ProviderManager</code>. This is discussed in the
          <a class="ulink" href="#core-services-erasing-credentials" target="_top">Core Services</a> chapter.</p>
      <div class="section" title="The <authentication-provider&gt; Element"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3459"></a>The <code class="literal">&lt;authentication-provider&gt;</code> Element</h4></div></div></div>
        
        <p> Unless used with a <code class="literal">ref</code> attribute, this element is shorthand for configuring a
            <a class="ulink" href="#core-services-dao-provider" target="_top"><code class="classname">DaoAuthenticationProvider</code></a>.
            <code class="classname">DaoAuthenticationProvider</code> loads user information from a
            <code class="interfacename">UserDetailsService</code> and compares the username/password
          combination with the values supplied at login. The
            <code class="interfacename">UserDetailsService</code> instance can be defined either by
          using an available namespace element (<code class="literal">jdbc-user-service</code> or by using the
            <code class="literal">user-service-ref</code> attribute to point to a bean defined elsewhere in
          the application context). You can find examples of these variations in the <a class="ulink" href="#ns-auth-providers" target="_top">namespace introduction</a>. </p>
        <div class="section" title="The <password-encoder&gt; Element"><div class="titlepage"><div><div><h5 class="title"><a name="d4e3472"></a>The <code class="literal">&lt;password-encoder&gt;</code> Element</h5></div></div></div>
          
          <p>Authentication providers can optionally be configured to use a password encoder as
            described in the <a class="ulink" href="#ns-password-encoder" target="_top">namespace introduction</a>.
            This will result in the bean being injected with the appropriate
              <code class="interfacename">PasswordEncoder</code> instance, potentially with an
            accompanying <code class="interfacename">SaltSource</code> bean to provide salt values for
            hashing. </p>
        </div>
      </div>
      <div class="section" title="Using <authentication-provider&gt; to refer to an AuthenticationProvider Bean"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3479"></a>Using <code class="literal">&lt;authentication-provider&gt;</code> to refer to an
            <code class="interfacename">AuthenticationProvider</code> Bean</h4></div></div></div>
        
        <p> If you have written your own <code class="interfacename">AuthenticationProvider</code>
          implementation (or want to configure one of Spring Security's own implementations as a
          traditional bean for some reason, then you can use the following syntax to add it to the
          internal <code class="classname">ProviderManager</code>'s list: </p><pre class="programlisting">
  &lt;security:authentication-manager&gt;
    &lt;security:authentication-provider ref="myAuthenticationProvider" /&gt;
  &lt;/security:authentication-manager&gt;
  &lt;bean id="myAuthenticationProvider" class="com.something.MyAuthenticationProvider"/&gt;
  </pre>
      </div>
    </div>
  </div>
  <div class="section" title="B.3&nbsp;Method Security"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e3487"></a>B.3&nbsp;Method Security</h2></div></div></div>
    
    <div class="section" title="B.3.1&nbsp;The <global-method-security&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="d4e3489"></a>B.3.1&nbsp;The <code class="literal">&lt;global-method-security&gt;</code> Element</h3></div></div></div>
      
      <p> This element is the primary means of adding support for securing methods on Spring
        Security beans. Methods can be secured by the use of annotations (defined at the interface
        or class level) or by defining a set of pointcuts as child elements, using AspectJ syntax. </p>
      <p> Method security uses the same <code class="interfacename">AccessDecisionManager</code>
        configuration as web security, but this can be overridden as explained above <a class="xref" href="appendix-namespace.html#nsa-access-decision-manager-ref" title="access-decision-manager-ref">the section called &#8220;<code class="literal">access-decision-manager-ref</code>&#8221;</a>, using the same attribute. </p>
      <div class="section" title="The secured-annotations and jsr250-annotations Attributes"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3496"></a>The <code class="literal">secured-annotations</code> and <code class="literal">jsr250-annotations</code>
          Attributes</h4></div></div></div>
        
        <p> Setting these to "true" will enable support for Spring Security's own
            <code class="literal">@Secured</code> annotations and JSR-250 annotations, respectively. They are
          both disabled by default. Use of JSR-250 annotations also adds a
            <code class="classname">Jsr250Voter</code> to the
            <code class="interfacename">AccessDecisionManager</code>, so you need to make sure you do
          this if you are using a custom implementation and want to use these annotations. </p>
      </div>
      <div class="section" title="Securing Methods using <protect-pointcut&gt;"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3504"></a>Securing Methods using <code class="literal">&lt;protect-pointcut&gt;</code></h4></div></div></div>
        
        <p> Rather than defining security attributes on an individual method or class basis using
          the <code class="literal">@Secured</code> annotation, you can define cross-cutting security
          constraints across whole sets of methods and interfaces in your service layer using the
            <code class="literal">&lt;protect-pointcut&gt;</code> element. This has two attributes: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="literal">expression</code> - the pointcut expression</p>
            </li><li class="listitem">
              <p><code class="literal">access</code> - the security attributes which apply</p>
            </li></ul></div><p> You can find an example in the <a class="ulink" href="#ns-protect-pointcut" target="_top">namespace introduction</a>. </p>
      </div>
      <div class="section" title="The <after-invocation-provider&gt; Element"><div class="titlepage"><div><div><h4 class="title"><a name="nsa-custom-after-invocation"></a>The <code class="literal">&lt;after-invocation-provider&gt;</code> Element</h4></div></div></div>
        
        <p> This element can be used to decorate an
            <code class="interfacename">AfterInvocationProvider</code> for use by the security
          interceptor maintained by the <code class="literal">&lt;global-method-security&gt;</code> namespace.
          You can define zero or more of these within the <code class="literal">global-method-security</code>
          element, each with a <code class="literal">ref</code> attribute pointing to an
            <code class="interfacename">AfterInvocationProvider</code> bean instance within your
          application context. </p>
      </div>
    </div>
    <div class="section" title="B.3.2&nbsp;LDAP Namespace Options"><div class="titlepage"><div><div><h3 class="title"><a name="d4e3527"></a>B.3.2&nbsp;LDAP Namespace Options</h3></div></div></div>
      
      <p> LDAP is covered in some details in <a class="ulink" href="#ldap" target="_top">its own chapter</a>. We
        will expand on that here with some explanation of how the namespace options map to Spring
        beans. The LDAP implementation uses Spring LDAP extensively, so some familiarity with that
        project's API may be useful. </p>
      <div class="section" title="Defining the LDAP Server using the <ldap-server&gt; Element"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3531"></a>Defining the LDAP Server using the <code class="literal">&lt;ldap-server&gt;</code>
          Element</h4></div></div></div>
        
        <p> This element sets up a Spring LDAP <code class="interfacename">ContextSource</code> for
          use by the other LDAP beans, defining the location of the LDAP server and other
          information (such as a username and password, if it doesn't allow anonymous access) for
          connecting to it. It can also be used to create an embedded server for testing. Details of
          the syntax for both options are covered in the <a class="ulink" href="#ldap-server" target="_top">LDAP
            chapter</a>. The actual <code class="interfacename">ContextSource</code> implementation
          is <code class="classname">DefaultSpringSecurityContextSource</code> which extends Spring LDAP's
            <code class="classname">LdapContextSource</code> class. The <code class="literal">manager-dn</code> and
            <code class="literal">manager-password</code> attributes map to the latter's
            <code class="literal">userDn</code> and <code class="literal">password</code> properties respectively. </p>
        <p> If you only have one server defined in your application context, the other LDAP
          namespace-defined beans will use it automatically. Otherwise, you can give the element an
          "id" attribute and refer to it from other namespace beans using the
            <code class="literal">server-ref</code> attribute. This is actually the bean Id of the
            <code class="literal">ContextSource</code> instance, if you want to use it in other traditional
          Spring beans. </p>
      </div>
      <div class="section" title="The <ldap-provider&gt; Element"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3547"></a>The <code class="literal">&lt;ldap-provider&gt;</code> Element</h4></div></div></div>
        
        <p> This element is shorthand for the creation of an
            <code class="classname">LdapAuthenticationProvider</code> instance. By default this will be
          configured with a <code class="classname">BindAuthenticator</code> instance and a
            <code class="classname">DefaultAuthoritiesPopulator</code>. As with all namespace authentication
          providers, it must be included as a child of the
            <code class="literal">authentication-provider</code> element.</p>
        <div class="section" title="The user-dn-pattern Attribute"><div class="titlepage"><div><div><h5 class="title"><a name="d4e3555"></a>The <code class="literal">user-dn-pattern</code> Attribute</h5></div></div></div>
          
          <p> If your users are at a fixed location in the directory (i.e. you can work out the
            DN directly from the username without doing a directory search), you can use this
            attribute to map directly to the DN. It maps directly to the
              <code class="literal">userDnPatterns</code> property of
              <code class="classname">AbstractLdapAuthenticator</code>. </p>
        </div>
        <div class="section" title="The user-search-base and user-search-filter Attributes"><div class="titlepage"><div><div><h5 class="title"><a name="d4e3561"></a>The <code class="literal">user-search-base</code> and <code class="literal">user-search-filter</code>
            Attributes</h5></div></div></div>
          
          <p> If you need to perform a search to locate the user in the directory, then you can
            set these attributes to control the search. The <code class="classname">BindAuthenticator</code>
            will be configured with a <code class="classname">FilterBasedLdapUserSearch</code> and the
            attribute values map directly to the first two arguments of that bean's constructor. If
            these attributes aren't set and no <code class="literal">user-dn-pattern</code> has been supplied
            as an alternative, then the default search values of
              <code class="literal">user-search-filter="(uid={0})"</code> and
              <code class="literal">user-search-base=""</code> will be used. </p>
        </div>
        <div class="section" title="group-search-filter, group-search-base, group-role-attribute and role-prefix Attributes"><div class="titlepage"><div><div><h5 class="title"><a name="d4e3571"></a><code class="literal">group-search-filter</code>, <code class="literal">group-search-base</code>,
              <code class="literal">group-role-attribute</code> and <code class="literal">role-prefix</code>
            Attributes</h5></div></div></div>
          
          <p> The value of <code class="literal">group-search-base</code> is mapped to the
              <code class="literal">groupSearchBase</code> constructor argument of
              <code class="classname">DefaultAuthoritiesPopulator</code> and defaults to "ou=groups". The
            default filter value is "(uniqueMember={0})", which assumes that the entry is of type
            "groupOfUniqueNames". <code class="literal">group-role-attribute</code> maps to the
              <code class="literal">groupRoleAttribute</code> attribute and defaults to "cn". Similarly
              <code class="literal">role-prefix</code> maps to <code class="literal">rolePrefix</code> and defaults to
            "ROLE_". </p>
        </div>
        <div class="section" title="The <password-compare&gt; Element"><div class="titlepage"><div><div><h5 class="title"><a name="d4e3585"></a>The <code class="literal">&lt;password-compare&gt;</code> Element</h5></div></div></div>
          
          <p> This is used as child element to <code class="literal">&lt;ldap-provider&gt;</code> and
            switches the authentication strategy from <code class="classname">BindAuthenticator</code> to
              <code class="classname">PasswordComparisonAuthenticator</code>. This can optionally be
            supplied with a <code class="literal">hash</code> attribute or with a child
              <code class="literal">&lt;password-encoder&gt;</code> element to hash the password before
            submitting it to the directory for comparison. </p>
        </div>
      </div>
      <div class="section" title="The <ldap-user-service&gt; Element"><div class="titlepage"><div><div><h4 class="title"><a name="d4e3594"></a>The <code class="literal">&lt;ldap-user-service&gt;</code> Element</h4></div></div></div>
        
        <p> This element configures an LDAP <code class="interfacename">UserDetailsService</code>.
          The class used is <code class="classname">LdapUserDetailsService</code> which is a combination of
          a <code class="classname">FilterBasedLdapUserSearch</code> and a
            <code class="classname">DefaultAuthoritiesPopulator</code>. The attributes it supports have the
          same usage as in <code class="literal">&lt;ldap-provider&gt;</code>. </p>
      </div>
    </div>
  </div>
<div class="footnotes"><br><hr width="100" align="left"><div class="footnote">
        <p><sup>[<a name="ftn.d4e3084" href="#d4e3084" class="para">15</a>] </sup>See the <a class="ulink" href="#ns-web-xml" target="_top"> introductory chapter</a> for how to set up
          the mapping from your <code class="literal">web.xml</code></p>
      </div><div class="footnote">
          <p><sup>[<a name="ftn.d4e3229" href="#d4e3229" class="para">16</a>] </sup>This feature is really just provided for convenience and is not intended for
            production (where a view technology will have been chosen and can be used to render a
            customized login page). The class
              <code class="classname">DefaultLoginPageGeneratingFilter</code> is responsible for rendering
            the login page and will provide login forms for both normal form login and/or OpenID if
            required.</p>
        </div><div class="footnote">
            <p><sup>[<a name="ftn.d4e3318" href="#d4e3318" class="para">17</a>] </sup>This doesn't affect the use of
                <code class="classname">PersistentTokenBasedRememberMeServices</code>, where the tokens are
              stored on the server side.</p>
          </div></div></div><!--Begin LoopFuse code--><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
			_lf_cid = "LF_48be82fa";
			_lf_remora();
		</script><!--End LoopFuse code--><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="appendix-schema.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;</td></tr><tr><td width="40%" align="left" valign="top">Appendix&nbsp;A.&nbsp;Security Database Schema&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="springsecurity.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;</td></tr></table></div></body></html>